<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Player</title>
</head>
<body style="margin: 0; padding: 0; overflow: hidden;">
<div id="player" style="position: absolute; top: -60px; left: 0; width: 100%; height: calc(100% + 120px);"></div>
<script>
    const randomPlayerId = 'player' + Date.now();
    document.getElementById('player').id = randomPlayerId;

    const parsedUrl = new URL(window.location.href);
    const UrlQueryData = parsedUrl.searchParams.get('data');

    const {videoId, progressUpdateInterval, ...playerVars}  = JSON.parse(UrlQueryData);

    // const {
    //     end,
    //     rel,
    //     list,
    //     color,
    //     loop,
    //     start,
    //     playsinline,
    //     hl,
    //     playlist,
    //     listType,
    //     controls,
    //     fs,
    //     cc_lang_pref,
    //     iv_load_policy,
    //     modestbranding,
    //     cc_load_policy,
    // } = data;
    // const playerVars = {
    //     // autoplay: data.autoplay || 0,
    //     cc_lang_pref: data.cc_lang_pref || '',
    //     cc_load_policy: data.cc_load_policy || 0,
    //     color: data.color || 'red',
    //     controls: data.controls || 1,
    //     // disablekb: data.disablekb || 0,
    //     // enablejsapi: data.enablejsapi || 0,
    //     end: data.end || undefined,
    //     fs: data.fs || 1,
    //     hl: data.hl || undefined,
    //     iv_load_policy: data.iv_load_policy || 1,
    //     list: data.list || '',
    //     listType: data.listType || '',
    //     loop: data.loop || 0,
    //     modestbranding: data.modestbranding || 0,
    //     // origin: data.origin || window.location.origin,
    //     playlist: data.playlist || '',
    //     playsinline: data.playsinline || 0,
    //     rel: data.rel || 1,
    //     // showinfo: data.showinfo || 1,  // Deprecated but still used in some cases
    //     start: data.start || 0,
    //     // widget_referrer: queryParams.widget_referrer || ''
    // };

    // const videoId = queryParams.videoId || '';

    var tag = document.createElement("script");
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName("script")[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player(randomPlayerId, {
            height: "1000",
            width: "1000",
            videoId: videoId,
            playerVars: playerVars,
            // events: {
            //     onReady: onPlayerReady,
            //     onStateChange: onPlayerStateChange,
            //     onPlaybackRateChange: onPlayerPlaybackRateChange,
            //     onError: onPlayerError,
            // },
        });
    }

    function onPlayerReady(event) {
        window.ReactNativeWebView.postMessage(
            JSON.stringify({ event: "onReady", data: event })
        );
    }

    function onPlayerStateChange(event) {
        window.ReactNativeWebView.postMessage(
            JSON.stringify({ event: "onStateChange", data: event.data })
        );

        if (event.data === 2 || event.data === 1) {
            // Paused or Playing after a seek
            window.ReactNativeWebView.postMessage(
                JSON.stringify({
                    event: "onSeek",
                    data: player.getCurrentTime(),
                })
            );
        }
    }

    function onPlayerPlaybackRateChange(event) {
        window.ReactNativeWebView.postMessage(
            JSON.stringify({ event: "onPlaybackRateChange", data: event.data })
        );
    }

    function onPlayerError(event) {
        window.ReactNativeWebView.postMessage(
            JSON.stringify({ event: "onError", data: event.data })
        );
    }

    window.addEventListener("message", (event) => {
        var message = JSON.parse(event.data);
        if (message.command === "pause") {
            player.pauseVideo();
        } else if (message.command === "play") {
            player.playVideo();
        } else if (message.command === "mute") {
            player.mute();
        } else if (message.command === "unmute") {
            player.unMute();
        } else if (message.command === "seekTo") {
            player.seekTo(message.time, true);
        }
    });

    setInterval(() => {
        if (player && player.getCurrentTime) {
            window.ReactNativeWebView.postMessage(
                JSON.stringify({
                    event: "onProgress",
                    data: player.getCurrentTime(),
                })
            );
        }
    }, 1000);
</script>
</body>
</html>
