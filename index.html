<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; overflow: hidden;">
<div id="player" style="position: absolute; top: -60px; left: 0; width: 100%; height: calc(100% + 120px);"></div>
<script>
    const randomPlayerId = 'player' + Date.now();
    document.getElementById('player').id = randomPlayerId;

    const parsedUrl = new URL(window.location.href);
    const UrlQueryData = parsedUrl.searchParams.get('data');

    const {
        end,
        list,
        color,
        start,
        rel_s,
        loop_s,
        listType,
        playerLang,
        playlist,
        videoId_s,
        controls_s,
        cc_lang_pref_s,
        contentScale_s,
        allowWebViewZoom,
        modestbranding_s,
        iv_load_policy,
        preventFullScreen_s,
        showClosedCaptions_s,
    } = JSON.parse(UrlQueryData);

    var tag = document.createElement("script");
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName("script")[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;

    function onYouTubeIframeAPIReady() {
        player = new YT.Player("player", {
            height: "100%",
            width: "100%",
            videoId: videoId_s,
            playerVars: {
                end: end,
                rel: rel_s,
                list: list,
                color: color,
                loop: loop_s,
                start: start,
                playsinline: 1,
                hl: playerLang,
                playlist: playlist,
                listType: listType,
                controls: controls_s,
                fs: preventFullScreen_s,
                cc_lang_pref: cc_lang_pref_s,
                iv_load_policy: iv_load_policy,
                modestbranding: modestbranding_s,
                cc_load_policy: showClosedCaptions_s,
            },
            events: {
                // onReady: onPlayerReady,
                // onStateChange: onPlayerStateChange,
                // onPlaybackRateChange: onPlayerPlaybackRateChange,
                // onError: onPlayerError,
            },
        });
        console.log(player)
    }

    function onPlayerReady(event) {
        window.ReactNativeWebView.postMessage(
            JSON.stringify({event: "onReady", data: event})
        );
    }

    function onPlayerStateChange(event) {
        window.ReactNativeWebView.postMessage(
            JSON.stringify({event: "onStateChange", data: event.data})
        );

        if (event.data === 2 || event.data === 1) {
            // Paused or Playing after a seek
            window.ReactNativeWebView.postMessage(
                JSON.stringify({
                    event: "onSeek",
                    data: player.getCurrentTime(),
                })
            );
        }
    }

    function onPlayerPlaybackRateChange(event) {
        window.ReactNativeWebView.postMessage(
            JSON.stringify({event: "onPlaybackRateChange", data: event.data})
        );
    }

    function onPlayerError(event) {
        window.ReactNativeWebView.postMessage(
            JSON.stringify({event: "onError", data: event.data})
        );
    }

    window.addEventListener("message", (event) => {
        var message = JSON.parse(event.data);
        if (message.command === "pause") {
            player.pauseVideo();
        } else if (message.command === "play") {
            player.playVideo();
        } else if (message.command === "mute") {
            player.mute();
        } else if (message.command === "unmute") {
            player.unMute();
        } else if (message.command === "seekTo") {
            player.seekTo(message.time, true);
        }
    });

    setInterval(() => {
        if (player && player.getCurrentTime) {
            window.ReactNativeWebView.postMessage(
                JSON.stringify({
                    event: "onProgress",
                    data: player.getCurrentTime(),
                })
            );
        }
    }, 1000);
</script>
</body>
</html>
